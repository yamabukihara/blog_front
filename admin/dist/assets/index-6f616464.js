import{p as x,e as c,o as N,f as $,w as l,m as f,j as r,g as b,l as v,i as n,k as C,s as a,y as I,z as P,N as o,v as U}from"./index-25b6f427.js";import{_ as q}from"./CommonPage-d9f08a53.js";import{_ as z,a as B}from"./CrudTable-4e3fed7c.js";import{u as T}from"./useCRUD-98c77b73.js";import{N as D}from"./Image-3d736508.js";import{N as M,a as g}from"./Tabs-1dd6aa6f.js";import{N as S}from"./Input-4dc6aa48.js";import{N as R}from"./Popconfirm-48a94d36.js";import"./AppPage-77502b8b.js";import"./Space-5eeaf57e.js";import"./RadioGroup-9f11dd0d.js";import"./get-slot-1efb97e5.js";import"./Checkbox-09b0afd8.js";import"./Forward-98208075.js";import"./download-953ccaa2.js";import"./utils-a56d3b30.js";import"./Add-d4ec7561.js";const ae=Object.assign({name:"留言管理"},{__name:"index",setup(V){x(()=>{w("all")});const s=c(null),d=c({nickname:""}),m=c({is_review:null}),{handleDelete:y}=T({name:"留言",doDelete:f.deleteMessages,refresh:()=>{var t;return(t=s.value)==null?void 0:t.handleSearch()}}),h=[{type:"selection",width:15,fixed:"left"},{title:"头像",key:"avatar",width:40,align:"center",render(t){return a(D,{height:40,imgProps:{style:{"border-radius":"3px"}},src:I(t.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"留言人",key:"nickname",width:60,align:"center",ellipsis:{tooltip:!0}},{title:"留言内容",key:"content",width:120,align:"center"},{title:"IP 地址",key:"ip_address",width:70,align:"center",ellipsis:{tooltip:!0}},{title:"IP 来源",key:"ip_source",width:70,align:"center",ellipsis:{tooltip:!0},render(t){return a("span",t.ip_source||"未知")}},{title:"留言时间",key:"created_at",align:"center",width:80,render(t){return a(o,{size:"small",type:"text",ghost:!0},{default:()=>U(t.created_at),icon:()=>a("i",{class:"i-mdi:update"})})}},{title:"状态",key:"is_review",width:50,align:"center",render(t){return a(P,{type:t.is_review?"success":"error"},{default:()=>t.is_review?"通过":"审核中"})}},{title:"操作",key:"actions",width:100,align:"center",fixed:"right",render(t){return[t.is_review?a(o,{size:"small",type:"warning",onClick:()=>p([t.id],!1)},{default:()=>"撤下",icon:()=>a("i",{class:"i-mi:circle-error"})}):a(o,{size:"small",type:"success",style:"margin-left: 15px;",onClick:()=>p([t.id],!0)},{default:()=>"通过",icon:()=>a("i",{class:"i-mi:circle-check"})}),a(R,{onPositiveClick:()=>y([t.id],!1)},{trigger:()=>a(o,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:()=>a("i",{class:"i-material-symbols:delete-outline"})}),default:()=>a("div",{},"确定删除该条留言吗?")})]}}];async function p(t,e){var i;if(!t.length){$message.info("请选择要审核的数据");return}await f.updateMessageReview(t,e),$message==null||$message.success(e?"审核成功":"撤下成功"),(i=s.value)==null||i.handleSearch()}function w(t){var e;switch(t){case"all":m.value.is_review=null;break;case"has_review":m.value.is_review=1;break;case"not_review":m.value.is_review=0;break}(e=s.value)==null||e.handleSearch()}return(t,e)=>(N(),$(q,{title:"留言管理"},{action:l(()=>{var i,u;return[r(n(o),{type:"error",disabled:!((i=s.value)!=null&&i.selections.length),onClick:e[0]||(e[0]=_=>{var k;return n(y)((k=s.value)==null?void 0:k.selections)})},{icon:l(()=>e[5]||(e[5]=[b("span",{class:"i-material-symbols:recycling-rounded"},null,-1)])),default:l(()=>[e[6]||(e[6]=v(" 批量删除 "))]),_:1},8,["disabled"]),r(n(o),{type:"success",disabled:!((u=s.value)!=null&&u.selections.length),onClick:e[1]||(e[1]=_=>p(s.value.selections,!0))},{icon:l(()=>e[7]||(e[7]=[b("span",{class:"i-ic:outline-approval"},null,-1)])),default:l(()=>[e[8]||(e[8]=v(" 批量通过 "))]),_:1},8,["disabled"])]}),default:l(()=>[r(n(M),{type:"line",animated:"","onUpdate:value":w},{prefix:l(()=>e[9]||(e[9]=[v(" 状态 ")])),default:l(()=>[r(n(g),{name:"all",tab:"全部"}),r(n(g),{name:"has_review",tab:"通过"}),r(n(g),{name:"not_review",tab:"审核中"})]),_:1}),r(B,{ref_key:"$table",ref:s,"query-items":d.value,"onUpdate:queryItems":e[4]||(e[4]=i=>d.value=i),"extra-params":m.value,columns:h,"get-data":n(f).getMessages},{queryBar:l(()=>[r(z,{label:"用户","label-width":40,"content-width":180},{default:l(()=>[r(n(S),{value:d.value.nickname,"onUpdate:value":e[2]||(e[2]=i=>d.value.nickname=i),clearable:"",type:"text",placeholder:"请输入用户昵称",onKeydown:e[3]||(e[3]=C(i=>{var u;return(u=s.value)==null?void 0:u.handleSearch()},["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{ae as default};
