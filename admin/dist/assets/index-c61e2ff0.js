import{e as f,p as F,m as p,o as c,f as _,w as s,j as n,i as t,k,V as z,a7 as C,a6 as R,q as D,s as i,y as O,z as v,v as N,N as g}from"./index-25b6f427.js";import{_ as V}from"./CommonPage-d9f08a53.js";import{_ as b,a as K}from"./CrudTable-4e3fed7c.js";import{_ as T}from"./CrudModal-b3ba9d09.js";import{l as x,e as j}from"./config-7d76553c.js";import{u as E}from"./useCRUD-98c77b73.js";import{a as L,N as M}from"./Checkbox-09b0afd8.js";import{N as P}from"./Image-3d736508.js";import{N as G}from"./Switch-884df479.js";import{N as y}from"./Input-4dc6aa48.js";import{N as A,b as H}from"./Space-5eeaf57e.js";import{N as J,a as U}from"./FormItem-d42d036b.js";import"./AppPage-77502b8b.js";import"./RadioGroup-9f11dd0d.js";import"./get-slot-1efb97e5.js";import"./Forward-98208075.js";import"./download-953ccaa2.js";import"./utils-a56d3b30.js";const ce=Object.assign({name:"用户列表"},{__name:"index",setup(Q){const d=f(null),o=f({username:"",nickname:"",login_type:null}),{modalVisible:m,modalLoading:S,handleSave:$,handleEdit:w,modalForm:u,modalFormRef:I}=E({name:"用户",doUpdate:p.updateUser,refresh:()=>{var e;return(e=d.value)==null?void 0:e.handleSearch()}}),h=f([]);F(()=>{var e;p.getRoleOption().then(a=>h.value=a.data),(e=d.value)==null||e.handleSearch()});const q=[{title:"头像",key:"avatar",width:30,align:"center",render(e){var a;return i(P,{height:30,imgProps:{style:{"border-radius":"3px"}},src:O((a=e.info)==null?void 0:a.avatar),"fallback-src":"http://dummyimage.com/400x400","show-toolbar-tooltip":!0})}},{title:"昵称",key:"nickname",width:60,align:"center",ellipsis:{tooltip:!0},render(e){var a;return i("span",(a=e.info)==null?void 0:a.nickname)}},{title:"登录方式",key:"login_type",width:40,align:"center",render(e){var a;return i(v,{type:(a=x[e.login_type])==null?void 0:a.tag},{default:()=>{var l;return((l=x[e.login_type])==null?void 0:l.name)||"未知"}})}},{title:"用户角色",key:"role",width:80,align:"center",render(e){if(e.is_super)return i(v,{type:"error"},{default:()=>"超级管理员"});const a=e.roles??[],l=[];for(let r=0;r<a.length;r++)l.push(i(v,{type:"info",style:{margin:"2px 3px"}},{default:()=>a[r].name}));return i("span",l.length?l:"无")}},{title:"登录 IP",key:"ip_address",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return i("span",e.ip_address||"未知")}},{title:"登录地址",key:"ip_source",width:70,align:"center",ellipsis:{tooltip:!0},render(e){return i("span",e.ip_source||"未知")}},{title:"创建时间",key:"created_at",align:"center",width:70,render(e){return i(g,{size:"small",type:"text",ghost:!0},{default:()=>N(e.created_at),icon:()=>i("i",{class:"i-mdi:update"})})}},{title:"上次登录时间",key:"last_login_time",align:"center",width:70,render(e){return i(g,{size:"small",type:"text",ghost:!0},{default:()=>N(e.last_login_time),icon:()=>i("i",{class:"i-mdi:update"})})}},{title:"禁用",key:"is_disable",width:30,align:"center",fixed:"left",render(e){return i(G,{size:"small",rubberBand:!1,value:e.is_disable,loading:!!e.publishing,onUpdateValue:()=>B(e)})}},{title:"操作",key:"actions",width:60,align:"center",fixed:"right",render(e){return[i(g,{size:"small",type:"primary",onClick:()=>{var a;e.nickname=(a=e.info)==null?void 0:a.nickname,e.role_ids=e.roles.map(l=>l.id),w(e)}},{default:()=>"编辑",icon:()=>i("i",{class:"i-material-symbols:delete-outline"})})]}}];async function B(e){var a;if(e.id){e.publishing=!0,e.is_disable=!e.is_disable;try{await p.updateUserDisable(e.id,e.is_disable),$message==null||$message.success(e.is_disable?"已禁用该用户":"已取消禁用该用户"),(a=d.value)==null||a.handleSearch()}catch(l){e.is_disable=!e.is_disable,console.error(l)}finally{e.publishing=!1}}}return(e,a)=>(c(),_(V,{title:"用户列表"},{default:s(()=>[n(K,{ref_key:"$table",ref:d,"query-items":o.value,"onUpdate:queryItems":a[6]||(a[6]=l=>o.value=l),columns:q,"get-data":t(p).getUsers},{queryBar:s(()=>[n(b,{label:"昵称","label-width":40,"content-width":160},{default:s(()=>[n(t(y),{value:o.value.nickname,"onUpdate:value":a[0]||(a[0]=l=>o.value.nickname=l),clearable:"",type:"text",placeholder:"请输入昵称",onKeydown:a[1]||(a[1]=k(l=>{var r;return(r=d.value)==null?void 0:r.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),n(b,{label:"用户名","label-width":60,"content-width":160},{default:s(()=>[n(t(y),{value:o.value.username,"onUpdate:value":a[2]||(a[2]=l=>o.value.username=l),clearable:"",type:"text",placeholder:"请输入用户名",onKeydown:a[3]||(a[3]=k(l=>{var r;return(r=d.value)==null?void 0:r.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),n(b,{label:"登录方式","label-width":70,"content-width":160},{default:s(()=>[n(t(A),{value:o.value.login_type,"onUpdate:value":[a[4]||(a[4]=l=>o.value.login_type=l),a[5]||(a[5]=l=>{var r;return(r=d.value)==null?void 0:r.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择登录方式",options:t(j)},null,8,["value","options"])]),_:1})]),_:1},8,["query-items","get-data"]),n(T,{visible:t(m),"onUpdate:visible":a[9]||(a[9]=l=>D(m)?m.value=l:null),title:"修改用户",loading:t(S),onSave:t($)},{default:s(()=>[n(t(J),{ref_key:"modalFormRef",ref:I,"label-placement":"left","label-align":"left","label-width":80,model:t(u)},{default:s(()=>[n(t(U),{label:"用户昵称",path:"name"},{default:s(()=>[n(t(y),{value:t(u).nickname,"onUpdate:value":a[7]||(a[7]=l=>t(u).nickname=l),clearable:"",placeholder:"请输入用户昵称"},null,8,["value"])]),_:1}),n(t(U),{label:"角色",path:"role_ids"},{default:s(()=>[n(t(L),{value:t(u).role_ids,"onUpdate:value":a[8]||(a[8]=l=>t(u).role_ids=l)},{default:s(()=>[n(t(H),{"item-style":"display: flex;"},{default:s(()=>[(c(!0),z(R,null,C(h.value,l=>(c(),_(t(M),{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","loading","onSave"])]),_:1}))}});export{ce as default};
