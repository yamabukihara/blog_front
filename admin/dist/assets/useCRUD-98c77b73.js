import{e as c,M as R}from"./index-25b6f427.js";function M(d={}){const u=c(null),f=c({...d});return{formRef:u,formModel:f,validation:async()=>{var s;try{return await((s=u.value)==null?void 0:s.validate()),!0}catch{return!1}},rules:{required:{required:!0,message:"此为必填项",trigger:["blur","change"]}}}}const S={view:"查看",edit:"编辑",add:"新增"};function C({name:d,initForm:u={},doCreate:f,doDelete:v,doUpdate:m,refresh:s}){const t=c(!1),n=c(""),o=c(!1),w=R(()=>S[n.value]+d),{formModel:r,formRef:g,validation:y}=M(u);function h(){n.value="add",t.value=!0,r.value={...u}}function p(e){n.value="edit",t.value=!0,r.value={...e}}function b(e){n.value="view",t.value=!0,r.value={...e}}async function A(){if(!["edit","add"].includes(n.value)){t.value=!1;return}if(!await y())return!1;const i={add:{api:()=>f(r.value),cb:()=>window.$message.success("新增成功")},edit:{api:()=>m(r.value),cb:()=>window.$message.success("编辑成功")}}[n.value];try{o.value=!0;const l=await i.api();i.cb(),o.value=t.value=!1,l&&s(l)}catch(l){console.error(l),o.value=!1}}async function $(e,i=!0){if(!e||Array.isArray(e)&&!e.length){window.$message.info("请选择要删除的数据");return}const l=async()=>{try{o.value=!0;let a;typeof e=="number"||typeof e=="string"?a=await v(e):a=await v(JSON.stringify(e)),(a==null?void 0:a.code)===0&&window.$message.success("删除成功"),o.value=!1,s(a)}catch(a){console.error(a),o.value=!1}};i?window.$dialog.confirm({content:"确定删除？",confirm:()=>l()}):l()}return{modalVisible:t,modalAction:n,modalTitle:w,modalLoading:o,handleAdd:h,handleDelete:$,handleEdit:p,handleView:b,handleSave:A,modalForm:r,modalFormRef:g}}export{C as u};
