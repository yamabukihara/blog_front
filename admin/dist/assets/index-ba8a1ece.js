import{e as b,p as P,o as N,f as z,w as i,m as u,j as n,g as A,l as q,i as a,k as O,V as G,a7 as I,a6 as L,q as j,s,z as K,v as w,N as p,t as H}from"./index-25b6f427.js";import{_ as J}from"./CommonPage-d9f08a53.js";import{_ as Q,a as W}from"./CrudTable-4e3fed7c.js";import{_ as U}from"./CrudModal-b3ba9d09.js";import{u as X}from"./useCRUD-98c77b73.js";import{N as Y}from"./GradientText-3fe630d7.js";import{N as Z}from"./Switch-884df479.js";import{N as y}from"./Input-4dc6aa48.js";import{N as S,a as v}from"./FormItem-d42d036b.js";import{N as ee,a as ae}from"./RadioGroup-9f11dd0d.js";import{b as le}from"./Space-5eeaf57e.js";import{N as te}from"./Popconfirm-48a94d36.js";import"./AppPage-77502b8b.js";import"./Checkbox-09b0afd8.js";import"./Forward-98208075.js";import"./download-953ccaa2.js";import"./get-slot-1efb97e5.js";const Ne=Object.assign({name:"接口管理"},{__name:"index",setup(ne){const d=b(null),m=b({keyword:""}),{modalVisible:f,modalAction:c,modalTitle:T,modalLoading:R,handleAdd:E,handleDelete:$,handleEdit:x,handleSave:_,modalForm:r,modalFormRef:g}=X({name:"接口",doCreate:u.saveOrUpdateResource,doDelete:u.deleteResource,doUpdate:u.saveOrUpdateResource,refresh:()=>{var e;return(e=d.value)==null?void 0:e.handleSearch()}});P(()=>{var e;(e=d.value)==null||e.handleSearch()});const B=["GET","POST","DELETE","PUT"];function h(e){switch(e){case"GET":return"info";case"POST":return"success";case"PUT":return"warning";case"DELETE":return"error";default:return"info"}}const C=[{title:"资源名称",key:"name",width:80,ellipsis:{tooltip:!0}},{title:"资源路径",key:"url",width:80,ellipsis:{tooltip:!0},render(e){return e.children?"-":s("span",{class:"color-[#1890ff]"},e.url)}},{title:"请求方式",key:"request_method",width:50,align:"center",render(e){return e.children?"-":s(K,{type:h(e.request_method)},{default:()=>e.request_method})}},{title:"匿名访问",key:"is_hidden",width:50,align:"center",fixed:"left",render(e){return e.children?"-":s(Z,{size:"small",rubberBand:!1,value:e.is_anonymous,loading:!!e.publishing,onUpdateValue:()=>D(e)})}},{title:"创建日期",key:"created_at",width:60,render(e){return s("span",w(e.created_at))}},{title:"操作",key:"actions",width:115,align:"center",fixed:"right",render(e){return[s(p,{size:"tiny",quaternary:!0,type:"primary",style:`display: ${e.children?"":"none"};`,onClick:()=>{E(),r.value.parent_id=e.id}},{default:()=>"新增",icon:()=>s("i",{class:"i-material-symbols:add"})}),s(p,{size:"tiny",quaternary:!0,type:"info",onClick:()=>e.children?V(e):x(e)},{default:()=>"编辑",icon:()=>s("i",{class:"i-material-symbols:edit-outline"})}),s(te,{onPositiveClick:()=>{$(e.id,!1)}},{trigger:()=>s(p,{size:"tiny",quaternary:!0,type:"error"},{default:()=>"删除",icon:()=>s("i",{class:"i-material-symbols:delete-outline"})}),default:()=>s("div",{},"确定删除该接口吗?")})]}}];async function D(e){if(e.id){e.publishing=!0,e.is_anonymous=!e.is_anonymous;try{await u.updateResourceAnonymous(e),$message==null||$message.success(e.is_anonymous?"已允许匿名访问":"已禁止匿名访问")}catch(l){e.is_anonymous=!e.is_anonymous,console.error(l)}finally{e.publishing=!1}}}const o=b(!1);function F(){c.value="add",r.value={},o.value=!0}function V(e){c.value="edit",r.value={...e},o.value=!0}async function M(){_(),o.value=!1}return(e,l)=>(N(),z(J,{title:"接口管理"},{action:i(()=>[n(a(p),{type:"primary",onClick:F},{icon:i(()=>l[9]||(l[9]=[A("span",{class:"i-material-symbols:add"},null,-1)])),default:i(()=>[l[10]||(l[10]=q(" 新增模块 "))]),_:1})]),default:i(()=>[n(W,{ref_key:"$table",ref:d,"query-items":m.value,"onUpdate:queryItems":l[2]||(l[2]=t=>m.value=t),"is-pagination":!1,columns:C,"get-data":a(u).getResources,"single-line":!0},{queryBar:i(()=>[n(Q,{label:"资源名","label-width":50},{default:i(()=>[n(a(y),{value:m.value.keyword,"onUpdate:value":l[0]||(l[0]=t=>m.value.keyword=t),clearable:"",type:"text",placeholder:"请输入资源名",onKeydown:l[1]||(l[1]=O(t=>{var k;return(k=d.value)==null?void 0:k.handleSearch()},["enter"]))},null,8,["value"])]),_:1})]),_:1},8,["query-items","get-data"]),n(U,{visible:a(f),"onUpdate:visible":l[6]||(l[6]=t=>j(f)?f.value=t:null),title:a(T),loading:a(R),onSave:a(_)},{default:i(()=>[n(a(S),{ref_key:"modalFormRef",ref:g,"label-placement":"left","label-align":"left","label-width":80,model:a(r)},{default:i(()=>[n(a(v),{label:"资源名",path:"name"},{default:i(()=>[n(a(y),{value:a(r).name,"onUpdate:value":l[3]||(l[3]=t=>a(r).name=t),placeholder:"请输入资源名"},null,8,["value"])]),_:1}),n(a(v),{label:"资源路径",path:"url"},{default:i(()=>[n(a(y),{value:a(r).url,"onUpdate:value":l[4]||(l[4]=t=>a(r).url=t),placeholder:"请输入资源路径"},null,8,["value"])]),_:1}),n(a(v),{label:"请求方式",path:"request_method"},{default:i(()=>[n(a(ee),{value:a(r).request_method,"onUpdate:value":l[5]||(l[5]=t=>a(r).request_method=t),name:"radiogroup"},{default:i(()=>[n(a(le),null,{default:i(()=>[(N(),G(L,null,I(B,t=>n(a(ae),{key:t,value:t},{default:i(()=>[n(a(Y),{type:h(t)},{default:i(()=>[q(H(t),1)]),_:2},1032,["type"])]),_:2},1032,["value"])),64))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading","onSave"]),n(U,{visible:o.value,"onUpdate:visible":l[8]||(l[8]=t=>o.value=t),title:`${a(c)==="add"?"新增":"编辑"}模块`,loading:a(f),onSave:M},{default:i(()=>[n(a(S),{ref_key:"modalFormRef",ref:g,"label-placement":"left","label-align":"left","label-width":80,model:a(r)},{default:i(()=>[n(a(v),{label:"模块名",path:"name"},{default:i(()=>[n(a(y),{value:a(r).name,"onUpdate:value":l[7]||(l[7]=t=>a(r).name=t),placeholder:"请输入模块名"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","loading"])]),_:1}))}});export{Ne as default};
