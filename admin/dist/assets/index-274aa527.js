import{_ as U}from"./CommonPage-d9f08a53.js";import{_ as P}from"./UploadOne-7705b998.js";import{u as R,e as p,p as C,o as q,f as B,w as l,j as a,i as s,g as v,l as f,m as _,N as b}from"./index-25b6f427.js";import{N as I,a as c}from"./Tabs-1dd6aa6f.js";import{N as g,a as d}from"./FormItem-d42d036b.js";import{N as i}from"./Input-4dc6aa48.js";import"./AppPage-77502b8b.js";import"./Upload-af1387d7.js";import"./Image-3d736508.js";import"./utils-a56d3b30.js";import"./download-953ccaa2.js";import"./Add-d4ec7561.js";const S={class:"m-7 flex items-center"},$={class:"mr-7 w-50"},L={__name:"index",setup(T){const n=R(),w=p(null),o=p({avatar:n.avatar,nickname:n.nickname,intro:n.intro,website:n.website});C(async()=>{await n.getUserInfo(),o.value={avatar:n.avatar,nickname:n.nickname,intro:n.intro,website:n.website}});async function y(){var u;(u=w.value)==null||u.validate(async e=>{e||(await _.updateCurrent(o.value),$message.success("更新成功!"),n.getUserInfo())})}const k={nickname:[{required:!0,message:"请输入昵称",trigger:["input","blur","change"]}]},m=p(null),t=p({old_password:"",new_password:"",confirm_password:""});function h(){var u;(u=m.value)==null||u.validate(async e=>{e||(await _.updateCurrentPassword(t.value),$message.success("修改成功!"))})}const N={old_password:[{required:!0,message:"请输入旧密码",trigger:["input","blur","change"]}],new_password:[{required:!0,message:"请输入新密码",trigger:["input","blur","change"]}],confirm_password:[{required:!0,message:"请再次输入密码",trigger:["input","blur"]},{validator:x,message:"两次密码输入不一致",trigger:"input"},{validator:F,message:"两次密码输入不一致",trigger:["blur","password-input"]}]};function x(u,e){return!!t.value.new_password&&t.value.new_password.startsWith(e)&&t.value.new_password.length>=e.length}function F(u,e){return e===t.value.new_password}return(u,e)=>(q(),B(U,{"show-header":!1},{default:l(()=>[a(s(I),{type:"line",animated:""},{default:l(()=>[a(s(c),{name:"website",tab:"修改信息"},{default:l(()=>[v("div",S,[v("div",$,[a(P,{preview:o.value.avatar,"onUpdate:preview":e[0]||(e[0]=r=>o.value.avatar=r),width:130},null,8,["preview"])]),a(s(g),{ref_key:"infoFormRef",ref:w,"label-placement":"left","label-align":"left","label-width":"100",model:o.value,rules:k,class:"w-80"},{default:l(()=>[a(s(d),{label:"昵称",path:"nickname"},{default:l(()=>[a(s(i),{value:o.value.nickname,"onUpdate:value":e[1]||(e[1]=r=>o.value.nickname=r),type:"text",placeholder:"请填写昵称"},null,8,["value"])]),_:1}),a(s(d),{label:"个人简介",path:"intro"},{default:l(()=>[a(s(i),{value:o.value.intro,"onUpdate:value":e[2]||(e[2]=r=>o.value.intro=r),type:"text",placeholder:"请填写个人简介"},null,8,["value"])]),_:1}),a(s(d),{label:"个人网站",path:"website"},{default:l(()=>[a(s(i),{value:o.value.website,"onUpdate:value":e[3]||(e[3]=r=>o.value.website=r),type:"text",placeholder:"请填写个人网站"},null,8,["value"])]),_:1}),a(s(b),{type:"primary",onClick:y},{default:l(()=>e[7]||(e[7]=[f(" 修改 ")])),_:1})]),_:1},8,["model"])])]),_:1}),a(s(c),{name:"contact",tab:"修改密码"},{default:l(()=>[a(s(g),{ref_key:"passwordFormRef",ref:m,"label-placement":"left","label-align":"left",model:t.value,"label-width":"100",rules:N,class:"m-[30px] w-[400px]"},{default:l(()=>[a(s(d),{label:"旧密码",path:"old_password"},{default:l(()=>[a(s(i),{value:t.value.old_password,"onUpdate:value":e[4]||(e[4]=r=>t.value.old_password=r),type:"password","show-password-on":"mousedown",placeholder:"请输入旧密码"},null,8,["value"])]),_:1}),a(s(d),{label:"新密码",path:"new_password"},{default:l(()=>[a(s(i),{value:t.value.new_password,"onUpdate:value":e[5]||(e[5]=r=>t.value.new_password=r),disabled:!t.value.old_password,type:"password","show-password-on":"mousedown",placeholder:"请输入新密码"},null,8,["value","disabled"])]),_:1}),a(s(d),{label:"确认密码",path:"confirm_password"},{default:l(()=>[a(s(i),{value:t.value.confirm_password,"onUpdate:value":e[6]||(e[6]=r=>t.value.confirm_password=r),disabled:!t.value.new_password,type:"password","show-password-on":"mousedown",placeholder:"请再次输入新密码"},null,8,["value","disabled"])]),_:1}),a(s(b),{type:"primary",onClick:h},{default:l(()=>e[8]||(e[8]=[f(" 修改 ")])),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}))}};export{L as default};
