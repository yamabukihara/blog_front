import{A as ae,B as te,C as le,D as ne,E as se,F as M,G as oe,H as ie,I as ue,e as g,J,K as re,L as de,M as z,O as pe,s as O,P as me,Q,z as X,N as E,R as ce,S as j,_ as ge,c as ve,T as fe,U as W,p as ye,x as he,m as A,o as $,f as q,w as i,g as be,j as l,i as n,V as G,W as L,l as D}from"./index-25b6f427.js";import{E as _e}from"./style-2d172ac4.js";import{_ as Ce}from"./CommonPage-d9f08a53.js";import{_ as Te}from"./CrudModal-b3ba9d09.js";import{_ as we}from"./UploadOne-7705b998.js";import{b as Re}from"./config-7d76553c.js";import{N as Se,a as I}from"./FormItem-d42d036b.js";import{u as Ve,N as K}from"./Input-4dc6aa48.js";import{s as Ie,a as Oe,b as Y,N as P}from"./Space-5eeaf57e.js";import{A as xe}from"./Add-d4ec7561.js";import{N as Ne,a as H}from"./RadioGroup-9f11dd0d.js";import{N as Be}from"./Switch-884df479.js";import"./AppPage-77502b8b.js";import"./Upload-af1387d7.js";import"./Image-3d736508.js";import"./utils-a56d3b30.js";import"./download-953ccaa2.js";import"./get-slot-1efb97e5.js";const Ue=ae({name:"DynamicTags",common:te,peers:{Input:le,Button:ne,Tag:se,Space:Ie},self(){return{inputWidth:"64px"}}}),Fe=Ue,ke=M("dynamic-tags",[M("input",{minWidth:"var(--n-input-width)"})]),De=Object.assign(Object.assign(Object.assign({},J.props),me),{size:{type:String,default:"medium"},closable:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[]},value:Array,inputClass:String,inputStyle:[String,Object],inputProps:Object,max:Number,tagClass:String,tagStyle:[String,Object],renderTag:Function,onCreate:{type:Function,default:u=>u},"onUpdate:value":[Function,Array],onUpdateValue:[Function,Array],onChange:[Function,Array]}),ze=oe({name:"DynamicTags",props:De,slots:Object,setup(u){const{mergedClsPrefixRef:h,inlineThemeDisabled:b}=ie(u),{localeRef:_}=Ve("DynamicTags"),v=ue(u),{mergedDisabledRef:d}=v,C=g(""),T=g(!1),a=g(!0),p=g(null),y=J("DynamicTags","-dynamic-tags",ke,Fe,u,h),w=g(u.defaultValue),B=re(u,"value"),R=de(B,w),U=z(()=>_.value.add),F=z(()=>Oe(u.size)),k=z(()=>d.value||!!u.max&&R.value.length>=u.max);function x(o){const{onChange:r,"onUpdate:value":c,onUpdateValue:N}=u,{nTriggerFormInput:Z,nTriggerFormChange:ee}=v;r&&j(r,o),N&&j(N,o),c&&j(c,o),w.value=o,Z(),ee()}function s(o){const r=R.value.slice(0);r.splice(o,1),x(r)}function e(o){switch(o.key){case"Enter":t()}}function t(o){const r=o??C.value;if(r){const c=R.value.slice(0);c.push(u.onCreate(r)),x(c)}T.value=!1,a.value=!0,C.value=""}function S(){t()}function m(){T.value=!0,Q(()=>{var o;(o=p.value)===null||o===void 0||o.focus(),a.value=!1})}const V=z(()=>{const{self:{inputWidth:o}}=y.value;return{"--n-input-width":o}}),f=b?pe("dynamic-tags",void 0,V,u):void 0;return{mergedClsPrefix:h,inputInstRef:p,localizedAdd:U,inputSize:F,inputValue:C,showInput:T,inputForceFocused:a,mergedValue:R,mergedDisabled:d,triggerDisabled:k,handleInputKeyDown:e,handleAddClick:m,handleInputBlur:S,handleCloseClick:s,handleInputConfirm:t,mergedTheme:y,cssVars:b?void 0:V,themeClass:f==null?void 0:f.themeClass,onRender:f==null?void 0:f.onRender}},render(){const{mergedTheme:u,cssVars:h,mergedClsPrefix:b,onRender:_,renderTag:v}=this;return _==null||_(),O(Y,{class:[`${b}-dynamic-tags`,this.themeClass],size:"small",style:h,theme:u.peers.Space,themeOverrides:u.peerOverrides.Space,itemStyle:"display: flex;"},{default:()=>{const{mergedTheme:d,tagClass:C,tagStyle:T,type:a,round:p,size:y,color:w,closable:B,mergedDisabled:R,showInput:U,inputValue:F,inputClass:k,inputStyle:x,inputSize:s,inputForceFocused:e,triggerDisabled:t,handleInputKeyDown:S,handleInputBlur:m,handleAddClick:V,handleCloseClick:f,handleInputConfirm:o,$slots:r}=this;return this.mergedValue.map((c,N)=>v?v(c,N):O(X,{key:N,theme:d.peers.Tag,themeOverrides:d.peerOverrides.Tag,class:C,style:T,type:a,round:p,size:y,color:w,closable:B,disabled:R,onClose:()=>{f(N)}},{default:()=>typeof c=="string"?c:c.label})).concat(U?r.input?r.input({submit:o,deactivate:m}):O(K,Object.assign({placeholder:"",size:s,style:x,class:k,autosize:!0},this.inputProps,{ref:"inputInstRef",value:F,onUpdateValue:c=>{this.inputValue=c},theme:d.peers.Input,themeOverrides:d.peerOverrides.Input,onKeydown:S,onBlur:m,internalForceFocus:e})):r.trigger?r.trigger({activate:V,disabled:t}):O(E,{dashed:!0,disabled:t,theme:d.peers.Button,themeOverrides:d.peerOverrides.Button,size:s,onClick:V},{icon:()=>O(ce,{clsPrefix:b},{default:()=>O(xe,null)})}))}})}});const Ae={class:"mb-4 flex items-center bg-white space-x-2"},$e={key:0,class:"i-line-md:uploading-loop"},je={key:0,class:"i-line-md:confirm-circle"},Le=Object.assign({name:"发布文章"},{__name:"index",setup(u){const h=ve(),b=fe(),_=g([]),v=g([]);let d=[];W(h,async()=>b.reloadTag()),ye(async()=>{C()}),he(async()=>{C()});async function C(){B(),A.getCategoryOption().then(s=>{_.value=s.data.map(e=>({value:e.label,label:e.label}))}),A.getTagOption().then(s=>{v.value=s.data.map(e=>({value:e.label,label:e.label})),d=v.value}),await Q()}const T=g(null),a=g({title:"",status:1,is_top:!1,type:1,tag_names:[],category_name:""}),p=g(!1),y=g(!1),w=g(null);W(()=>a.value.tag_names,s=>{v.value=d.filter(e=>!s.includes(e.label))},{deep:!0});async function B(){var e,t,S;const s=h.params.id;if(!s){a.value={status:1,is_top:!1,title:"",type:1};return}(e=window.$loadingBar)==null||e.start();try{const m=await A.getArticleById(s),{category:V,tags:f}=m.data;a.value=m.data,a.value.tag_names=f.map(o=>o.name),a.value.category_name=V.name,(t=window.$loadingBar)==null||t.finish()}catch{(S=window.$loadingBar)==null||S.error(),$message==null||$message.error("加载失败")}}function R(){$message.info("保存草稿开发中")}function U(){var s,e;if(!a.value.title||!((s=a.value.title)!=null&&s.trim())){a.value.title=(e=a.value.title)==null?void 0:e.trim(),$message.info("请输入标题");return}y.value=!0}async function F(){var s;(s=T.value)==null||s.validate(async e=>{if(!e){p.value=!0;try{await A.saveOrUpdateArticle(a.value),y.value=!1,$message.success("操作成功!"),b.removeTag(h.path)}catch(t){console.error(t)}finally{p.value=!1}}})}const k={category_name:{required:!0,message:"请选择文章分类",trigger:["blur","change"]},tag_names:{required:!0,message:"请选择文章标签"}};function x(s,e){return O(X,{type:"info",disabled:e>3,closable:!0,onClose:()=>a.value.tag_names.splice(e,1)},{default:()=>s})}return(s,e)=>($(),q(Ce,{"show-header":!1,title:"写文章"},{default:i(()=>[be("div",Ae,[l(n(K),{value:a.value.title,"onUpdate:value":e[0]||(e[0]=t=>a.value.title=t),type:"text",class:"mr-5 flex-1 py-1 text-lg color-primary font-bold",placeholder:"输入文章标题..."},null,8,["value"]),l(n(E),{ghost:"",type:"error",loading:p.value,onClick:R},{icon:i(()=>[p.value?L("",!0):($(),G("span",$e))]),default:i(()=>[e[11]||(e[11]=D(" 保存草稿 "))]),_:1},8,["loading"]),l(n(E),{type:"error",loading:p.value,onClick:U},{icon:i(()=>[p.value?L("",!0):($(),G("span",je))]),default:i(()=>[e[12]||(e[12]=D(" 发布文章 "))]),_:1},8,["loading"])]),l(n(_e),{modelValue:a.value.content,"onUpdate:modelValue":e[1]||(e[1]=t=>a.value.content=t),style:{height:"calc(100vh - 245px)"}},null,8,["modelValue"]),l(Te,{visible:y.value,"onUpdate:visible":e[10]||(e[10]=t=>y.value=t),title:"发布文章",loading:p.value,"show-footer":"",onSave:F},{default:i(()=>[l(n(Se),{ref_key:"formRef",ref:T,"label-placement":"left","label-align":"left","label-width":100,model:a.value,rules:k},{default:i(()=>[l(n(I),{label:"文章分类",path:"category_name"},{default:i(()=>[l(n(P),{value:a.value.category_name,"onUpdate:value":e[2]||(e[2]=t=>a.value.category_name=t),style:{width:"50%"},clearable:"",filterable:"",tag:"",placeholder:"关键字搜索，enter 添加",options:_.value},null,8,["value","options"])]),_:1}),l(n(I),{label:"文章标签",path:"tag_names"},{default:i(()=>[l(n(ze),{value:a.value.tag_names,"onUpdate:value":e[4]||(e[4]=t=>a.value.tag_names=t),"render-tag":x,max:3},{input:i(({submit:t,deactivate:S})=>[l(n(P),{value:w.value,"onUpdate:value":[e[3]||(e[3]=m=>w.value=m),m=>{t(m),w.value=null}],size:"small",filterable:"",tag:"",clearable:"",options:v.value,placeholder:"标签名称",onBlur:S},{action:i(()=>e[13]||(e[13]=[D(" 输入标签名搜索，enter 添加自定义标签 ")])),_:2},1032,["value","options","onUpdate:value","onBlur"])]),_:1},8,["value"])]),_:1}),l(n(I),{label:"文章类型",path:"type"},{default:i(()=>[l(n(P),{value:a.value.type,"onUpdate:value":e[5]||(e[5]=t=>a.value.type=t),style:{width:"50%"},placeholder:"请选择文章分类",options:n(Re)},null,8,["value","options"])]),_:1}),a.value.type===2||a.value.type===3?($(),q(n(I),{key:0,label:"原文地址",path:"original_url"},{default:i(()=>[l(n(K),{value:a.value.original_url,"onUpdate:value":e[6]||(e[6]=t=>a.value.original_url=t),type:"text",placeholder:"请填写原文连接"},null,8,["value"])]),_:1})):L("",!0),l(n(I),{label:"文章缩略图",path:"img"},{default:i(()=>[l(we,{preview:a.value.img,"onUpdate:preview":e[7]||(e[7]=t=>a.value.img=t),width:220},null,8,["preview"])]),_:1}),l(n(I),{label:"置顶",path:"is_top"},{default:i(()=>[l(n(Be),{value:a.value.is_top,"onUpdate:value":e[8]||(e[8]=t=>a.value.is_top=t)},null,8,["value"])]),_:1}),l(n(I),{label:"发布形式",path:"status"},{default:i(()=>[l(n(Ne),{value:a.value.status,"onUpdate:value":e[9]||(e[9]=t=>a.value.status=t),name:"radiogroup"},{default:i(()=>[l(n(Y),null,{default:i(()=>[l(n(H),{value:1},{default:i(()=>e[14]||(e[14]=[D(" 公开 ")])),_:1}),l(n(H),{value:2},{default:i(()=>e[15]||(e[15]=[D(" 私密 ")])),_:1})]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","loading"])]),_:1}))}}),sa=ge(Le,[["__scopeId","data-v-6e7e575d"]]);export{sa as default};
