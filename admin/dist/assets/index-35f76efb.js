import{c as R,b as j,e as f,p as I,m,x as P,o as V,f as E,w as s,j as i,g as y,l as v,i as n,k as F,s as o,y as J,z as S,N as p,v as K}from"./index-25b6f427.js";import{_ as L}from"./CommonPage-d9f08a53.js";import{_ as b,a as M}from"./CrudTable-4e3fed7c.js";import{u as W}from"./useCRUD-98c77b73.js";import{a as U,b as G}from"./config-7d76553c.js";import{N as H}from"./Image-3d736508.js";import{N as Q}from"./Switch-884df479.js";import{N as X}from"./Upload-af1387d7.js";import{N as Y,a as g}from"./Tabs-1dd6aa6f.js";import{N as Z}from"./Input-4dc6aa48.js";import{N as h}from"./Space-5eeaf57e.js";import{N as ee}from"./Popconfirm-48a94d36.js";import"./AppPage-77502b8b.js";import"./Checkbox-09b0afd8.js";import"./RadioGroup-9f11dd0d.js";import"./get-slot-1efb97e5.js";import"./Forward-98208075.js";import"./download-953ccaa2.js";import"./utils-a56d3b30.js";import"./Add-d4ec7561.js";const te={class:"inline-block"},xe=Object.assign({name:"文章列表"},{__name:"index",setup(le){const C=R(),T=j(),k=f([]),w=f([]),r=f(null),d=f({title:"",type:null,category_id:null,tag_id:null}),u=f({is_delete:null,status:null}),{handleDelete:N}=W({name:"文章",doDelete:O,refresh:()=>{var t;return(t=r.value)==null?void 0:t.handleSearch()}});I(()=>{m.getCategoryOption().then(t=>k.value=t.data),m.getTagOption().then(t=>w.value=t.data),x("all")}),P(()=>{var e;const{needRefresh:t}=C.query;t&&((e=r.value)==null||e.handleSearch())});const _=[{type:"selection",width:20,fixed:"left"},{title:"文章封面",key:"img",width:55,align:"center",render(t){return o(H,{imgProps:{style:{"border-radius":"2px",height:"100%",width:"100%"}},src:J(t.img),fallbackSrc:"http://dummyimage.com/400x400",showToolbarTooltip:!0})}},{title:"文章标题",key:"title",width:120,align:"center",ellipsis:{tooltip:!0}},{title:"分类",key:"category.name",width:60,align:"center",ellipsis:{tooltip:!0},render(t){return o("div",t.category.name||"无")}},{title:"标签",key:"tags",width:100,align:"center",render(t){const e=t.tags??[],l=[];for(let a=0;a<e.length;a++)l.push(o(S,{type:"info",style:{margin:"2px 3px"}},{default:()=>e[a].name}));return o("div",l.length?l:"无")}},{title:"浏览量",key:"view_count",width:40,align:"center",ellipsis:{tooltip:!0}},{title:"点赞量",key:"like_count",width:40,align:"center",ellipsis:{tooltip:!0}},{title:"类型",key:"type",width:50,align:"center",render(t){var e;return o(S,{type:(e=U[t.type])==null?void 0:e.tag},{default:()=>{var l;return(l=U[t.type])==null?void 0:l.name}})}},{title:"发布时间",key:"updateDate",align:"center",width:80,render(t){return o(p,{size:"small",type:"text",ghost:!0},{default:()=>K(t.updated_at),icon:()=>o("i",{class:"i-mdi:update"})})}},{title:"置顶",key:"is_top",width:50,align:"center",fixed:"left",render(t){return o(Q,{size:"small",rubberBand:!1,value:t.is_top,loading:!!t.publishing,onUpdateValue:()=>D(t)})}},{title:"操作",key:"actions",width:120,align:"center",fixed:"right",render(t){return[t.is_delete?o(p,{size:"small",type:"success",secondary:!0,onClick:async()=>{var e;await m.softDeleteArticle([t.id],!1),await((e=r.value)==null?void 0:e.handleSearch())}},{default:()=>"恢复",icon:()=>o("i",{class:"i-majesticons:eye-line"})}):o(p,{size:"small",type:"primary",secondary:!0,onClick:()=>T.push(`/article/write/${t.id}`)},{default:()=>"查看",icon:()=>o("i",{class:"i-majesticons:eye-line"})}),o(ee,{onPositiveClick:()=>N([t.id],!1)},{trigger:()=>o(p,{size:"small",type:"error",style:"margin-left: 15px;"},{default:()=>"删除",icon:()=>o("i",{class:"i-material-symbols:delete-outline"})}),default:()=>o("div",{},"确定删除该文章吗?")})]}}];function O(t){u.value.is_delete?m.deleteArticle(t):m.softDeleteArticle(JSON.parse(t),!0)}async function D(t){var e;if(t.id){t.publishing=!0,t.is_top=!t.is_top;try{await m.updateArticleTop(t.id,t.is_top),$message==null||$message.success(t.is_top?"已成功置顶":"已取消置顶"),(e=r.value)==null||e.handleSearch()}catch(l){console.error(l)}finally{t.publishing=!1}}}async function A(t){var l;const e=(l=r.value)==null?void 0:l.tableData.filter(a=>t.includes(a.id));for(const a of e)z(a.content,`${a.title}.md`)}function x(t){var e;switch(t){case"all":u.value.is_delete=0,u.value.status=null;break;case"public":u.value.is_delete=0,u.value.status=1;break;case"secret":u.value.is_delete=0,u.value.status=2;break;case"draft":u.value.is_delete=0,u.value.status=3;break;case"delete":u.value.is_delete=1,u.value.status=null;break}(e=r.value)==null||e.handleSearch()}function B(t){return t.file.name.endsWith(".md")?!0:($message.error("只能上传 .md 格式的文件，请重新上传"),!1)}function q({event:t}){var a;const e=(t==null?void 0:t.target).response;JSON.parse(e).code===0?((a=r.value)==null||a.handleSearch(),$message.success("文章导入成功！")):$message.error("文章导入失败！")}function z(t,e){const l=document.createElement("a");l.download=e,l.style.display="none";const a=new Blob([t]);l.href=URL.createObjectURL(a),document.body.appendChild(l),l.click(),document.body.removeChild(l)}return(t,e)=>(V(),E(L,{title:"文章列表"},{action:s(()=>{var l,a;return[i(n(p),{type:"primary",onClick:e[0]||(e[0]=$=>t.$router.replace("/article/write"))},{icon:s(()=>e[12]||(e[12]=[y("i",{class:"i-material-symbols:add"},null,-1)])),default:s(()=>[e[13]||(e[13]=v(" 新建文章 "))]),_:1}),i(n(p),{type:"error",disabled:!((l=r.value)!=null&&l.selections.length),onClick:e[1]||(e[1]=$=>{var c;return n(N)((c=r.value)==null?void 0:c.selections)})},{icon:s(()=>e[14]||(e[14]=[y("i",{class:"i-material-symbols:recycling-rounded"},null,-1)])),default:s(()=>[e[15]||(e[15]=v(" 批量删除 "))]),_:1},8,["disabled"]),i(n(p),{type:"info",disabled:!((a=r.value)!=null&&a.selections.length),onClick:e[2]||(e[2]=$=>{var c;return A((c=r.value)==null?void 0:c.selections)})},{icon:s(()=>e[16]||(e[16]=[y("i",{class:"i-mdi:export"},null,-1)])),default:s(()=>[e[17]||(e[17]=v(" 批量导出 "))]),_:1},8,["disabled"]),y("div",te,[i(n(X),{action:"/api/article/import","show-file-list":!1,multiple:"",onBeforeUpload:B,onFinish:q},{default:s(()=>[i(n(p),{type:"success"},{icon:s(()=>e[18]||(e[18]=[y("i",{class:"i-mdi:import"},null,-1)])),default:s(()=>[e[19]||(e[19]=v(" 批量导入 "))]),_:1})]),_:1})])]}),default:s(()=>[i(n(Y),{type:"line",animated:"","onUpdate:value":x},{prefix:s(()=>e[20]||(e[20]=[v(" 状态 ")])),default:s(()=>[i(n(g),{name:"all",tab:"全部"}),i(n(g),{name:"public",tab:"公开"}),i(n(g),{name:"secret",tab:"私密"}),i(n(g),{name:"draft",tab:"草稿箱"}),i(n(g),{name:"delete",tab:"回收站"})]),_:1}),i(M,{ref_key:"$table",ref:r,"query-items":d.value,"onUpdate:queryItems":e[11]||(e[11]=l=>d.value=l),"extra-params":u.value,columns:_,"get-data":n(m).getArticles},{queryBar:s(()=>[i(b,{label:"标题","label-width":40,"content-width":180},{default:s(()=>[i(n(Z),{value:d.value.title,"onUpdate:value":e[3]||(e[3]=l=>d.value.title=l),clearable:"",type:"text",placeholder:"请输入标题",onKeydown:e[4]||(e[4]=F(l=>{var a;return(a=r.value)==null?void 0:a.handleSearch()},["enter"]))},null,8,["value"])]),_:1}),i(b,{label:"类型","label-width":40,"content-width":160},{default:s(()=>[i(n(h),{value:d.value.type,"onUpdate:value":[e[5]||(e[5]=l=>d.value.type=l),e[6]||(e[6]=l=>{var a;return(a=r.value)==null?void 0:a.handleSearch()})],clearable:"",placeholder:"请选择文章类型",options:n(G)},null,8,["value","options"])]),_:1}),i(b,{label:"分类","label-width":40,"content-width":160},{default:s(()=>[i(n(h),{value:d.value.category_id,"onUpdate:value":[e[7]||(e[7]=l=>d.value.category_id=l),e[8]||(e[8]=l=>{var a;return(a=r.value)==null?void 0:a.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择文章分类",options:k.value},null,8,["value","options"])]),_:1}),i(b,{label:"标签","label-width":40,"content-width":160},{default:s(()=>[i(n(h),{value:d.value.tag_id,"onUpdate:value":[e[9]||(e[9]=l=>d.value.tag_id=l),e[10]||(e[10]=l=>{var a;return(a=r.value)==null?void 0:a.handleSearch()})],clearable:"",filterable:"",placeholder:"请选择文章标签",options:w.value},null,8,["value","options"])]),_:1})]),_:1},8,["query-items","extra-params","get-data"])]),_:1}))}});export{xe as default};
