import{_ as pe,I as ve,C as he,r as h,E as ge,l as D,b as n,c as a,f as e,u as L,s as H,e as C,M as ye,j as T,H as S,N as be,v as I,i as d,F as z,z as P,o as xe,L as we,w as Ce,n as $e,y as F,h as Y,x as A}from"./index.08377aad.js";import{d as fe}from"./dayjs.min.f2568ad6.js";import{_ as Re}from"./ULoading.6ad0004d.js";const Se={key:0,class:"mt-4 flex border-1 border-color-#90939950 border-rounded-1rem border-solid p-2"},Le=["src"],Te={class:"my-1 ml-3 w-full"},Ie=["placeholder"],Me={class:"flex justify-between"},Ne={__name:"CommentField",props:{type:Number,show:Boolean,topicId:Number},emits:["afterSubmit"],setup(c,{expose:x,emit:M}){var w;const p=c,r=M,[i,g]=[ve(),he()],k=h(p.show),u=ge({nickname:"",content:"",topic_id:(w=p.topicId)!=null?w:0,reply_user_id:0,parent_id:0,type:p.type}),$=D(()=>!!u.nickname);function y(v){k.value=v}async function f(){var v,b;if(!i.userId){g.setLoginFlag(!0);return}if(!u.content.trim()){(v=window.$message)==null||v.error("\u8BC4\u8BBA\u5185\u5BB9\u4E0D\u80FD\u4E3A\u7A7A");return}try{await S.saveComment(u),(b=window.$message)==null||b.info("\u8BC4\u8BBA\u6210\u529F"),u.content="",$.value&&y(!1),r("afterSubmit")}catch(R){console.error(R)}}function N(){var v;(v=window.$message)==null||v.info("\u8868\u60C5\u9009\u62E9\u6B63\u5728\u5F00\u53D1\u4E2D...")}const m=D(()=>u.nickname?`\u56DE\u590D @${u.nickname}\uFF1A`:"\u7559\u4E0B\u70B9\u4EC0\u4E48\u5427...");return x({data:u,setReply:y}),(v,b)=>k.value?(n(),a("div",Se,[e("img",{class:"h-9 w-9",src:L(H)(L(i).avatar)},null,8,Le),e("div",Te,[C(e("textarea",{"onUpdate:modelValue":b[0]||(b[0]=R=>u.content=R),placeholder:m.value,rows:"5",class:"w-full rounded bg-light-400 p-2 outline-none"},null,8,Ie),[[ye,u.content]]),e("div",Me,[e("span",{class:"i-mdi:emoticon-happy-outline cursor-pointer text-xl text-orange",onClick:N}),e("div",null,[u.nickname?(n(),a("span",{key:0,class:"the-button mr-4 bg-bluegray hover:bg-bluegray",onClick:b[1]||(b[1]=R=>y(!1))}," \u53D6\u6D88 ")):T("",!0),e("span",{class:"the-button",onClick:f}," \u63D0\u4EA4 ")])])])])):T("",!0)}},me=pe(Ne,[["__scopeId","data-v-92673d6f"]]);const Fe={class:"mb-2.5 mt-4 text-[12px]"},Ye={class:"mr-10"},ze=["onClick"],De={key:0,class:"color-#00a1d6 font-bold"},Ae={key:1},He={__name:"Paging",props:be({pageTotal:Number,index:Number,commentId:Number},{pageTotal:0}),emits:["changeCurrent"],setup(c,{expose:x,emit:M}){const p=M,r=h(!1),i=h(1),g=D(()=>f=>f===i.value);function k(){i.value-=1,p("changeCurrent",i.value,c.index,c.commentId)}function u(){i.value+=1,p("changeCurrent",i.value,c.index,c.commentId)}function $(f){i.value=f,p("changeCurrent",i.value,c.index,c.commentId)}function y(f){r.value=f}return x({current:i,setShow:y}),(f,N)=>C((n(),a("div",Fe,[e("span",Ye," \u5171 "+d(c.pageTotal)+" \u9875 ",1),C(e("a",{onClick:k}," \u4E0A\u4E00\u9875 ",512),[[I,i.value!==1]]),c.pageTotal<6?(n(!0),a(z,{key:0},P(c.pageTotal,m=>(n(),a("a",{key:m,class:"mx-1",onClick:w=>$(m)},[g.value(m)?(n(),a("span",De,d(m),1)):(n(),a("span",Ae,d(m),1))],8,ze))),128)):T("",!0),C(e("a",{onClick:u}," \u4E0B\u4E00\u9875 ",512),[[I,i.value!==c.pageTotal]])],512)),[[I,r.value]])}},Pe=pe(He,[["__scopeId","data-v-a9905100"]]),Ve={key:0},Be={class:"mb-4 mt-7 flex items-center text-xl font-bold"},Ee=["src"],je={class:"ml-3 flex flex-1 flex-col"},Ue={key:0,class:"text-sm"},qe=["href"],Ge={class:"flex justify-between text-sm"},Je={class:"flex items-center gap-2 py-1 color-#b3b3b3"},Ke=["onClick"],Oe=["onClick"],Qe=["innerHTML"],We=["src"],Xe={class:"ml-2 flex flex-1 flex-col"},Ze={key:0,class:"text-sm"},et=["href"],tt={class:"flex justify-between text-sm"},st={class:"flex items-center gap-2 py-1 color-#b3b3b3"},nt=["onClick"],at=["onClick"],ot=["href"],lt={key:1},it=["innerHTML"],ct=["onClick"],rt={key:0,class:"my-2.5 h-0.5 bg-light-500"},ut={class:"m-4 f-c-c"},dt={key:1,class:"mb-10 mt-30 text-center text-zinc"},pt={__name:"Comment",props:{type:Number},setup(c){var E;const[x,M]=[ve(),he()];xe(()=>{u()});const p=+((E=we().params.id)!=null?E:0),r=h([]),i=h(0),g=h(!1),k=ge({type:c.type,page_size:10,page_num:1,topic_id:p});async function u(){g.value=!0;try{const s=await S.getComments(k);console.log(s.data.page_data),setTimeout(()=>{k.page_num===1?r.value=s.data.page_data:r.value.push(...s.data.page_data),i.value=s.data.total,console.log(i.value),k.page_num++,g.value=!1},800)}catch(s){console.error(s)}}function $(){k.page_num=1,u()}const y=h(!0);Ce(r,()=>{y.value=!1,$e(()=>{y.value=!0})},{deep:!1});const f=h(null);function N(s,o){f.value.forEach(_=>_.setReply(!1));const t=f.value[s];t&&(t.setReply(!0),t.data.nickname=o.nickname,t.data.reply_user_id=o.user_id,t.data.parent_id=r.value[s].id)}const m=h([]),w=h([]);async function v(s){const{data:o}=await S.getCommentReplies(r.value[s].id,{page_size:5,page_num:m.value[s].current});r.value[s].reply_list=o,r.value[s].reply_count++,r.value[s].reply_count>5&&m.value[s].setShow(!0),w.value[s].style.display="none"}async function b(s,o){const{data:t}=await S.getCommentReplies(o.id,{page_num:1,page_size:5});o.reply_list=t,o.reply_count>5&&m.value[s].setShow(!0),w.value[s].style.display="none"}async function R(s,o,t){const{data:_}=await S.getCommentReplies(t,{page_num:s,page_size:5});r.value[o].reply_list=_}async function V(s){var o,t;if(!x.userId){M.setLoginFlag(!0);return}try{await S.saveLikeComment(s.id),x.commentLikeSet.includes(s.id)?(s.like_count--,(o=window.$message)==null||o.info("\u5DF2\u53D6\u6D88")):(s.like_count++,(t=window.$message)==null||t.success("\u5DF2\u70B9\u8D5E")),x.commentLike(s.id)}catch(_){console.error(_)}}const B=D(()=>s=>x.commentLikeSet.includes(s));return(s,o)=>(n(),a("div",null,[o[3]||(o[3]=e("p",{class:"flex items-center text-xl font-bold"},[e("span",{class:"i-fa:comments mr-3 text-blue"}),F(" \u8BC4\u8BBA ")],-1)),Y(me,{show:!0,type:c.type,"topic-id":p,onAfterSubmit:$},null,8,["type"]),i.value&&y.value?(n(),a("div",Ve,[e("p",Be,[e("span",null,d(i.value)+" \u8BC4\u8BBA ",1),e("span",{class:A(["i-uiw:reload ml-4 cursor-pointer text-base",g.value?"animate-spin":""]),onClick:$},null,2)]),(n(!0),a(z,null,P(r.value,(t,_)=>{var j,U,q,G,J,K,O,Q,W,X;return n(),a("div",{key:t.id,class:"my-1 flex"},[e("img",{src:L(H)((U=(j=t.user)==null?void 0:j.info)==null?void 0:U.avatar),class:"h-[40px] w-[40px] duration-600 hover:rotate-360"},null,8,Ee),e("div",je,[e("div",null,[(G=(q=t.user)==null?void 0:q.info)!=null&&G.website?(n(),a("a",{key:1,href:(Q=(O=t.user)==null?void 0:O.info)==null?void 0:Q.website,target:"_blank",class:"color-[#1abc9c] font-500 transition-300"},d((X=(W=t.user)==null?void 0:W.info)==null?void 0:X.nickname),9,qe)):(n(),a("span",Ue,d((K=(J=t.user)==null?void 0:J.info)==null?void 0:K.nickname),1))]),e("div",Ge,[e("div",Je,[e("span",null,d(i.value-_)+"\u697C ",1),e("span",null,d(L(fe)(t.created_at).format("YYYY-MM-DD")),1),e("button",{class:A(["i-mdi:thumb-up hover-bg-red",B.value(t.id)?"bg-red":""]),onClick:l=>V(t)},null,10,Ke),C(e("span",null,d(t.like_count),513),[[I,t.like_count]])]),e("button",{class:"color-#ef2f11",onClick:l=>N(_,t)}," \u56DE\u590D ",8,Oe)]),e("div",{class:"my-1",innerHTML:t.content},null,8,Qe),(n(!0),a(z,null,P(t.reply_list,l=>{var Z,ee,te,se,ne,ae,oe,le,ie,ce,re,ue,de,_e;return n(),a("div",{key:l.id,class:"mt-2 flex"},[e("img",{src:L(H)((ee=(Z=l.user)==null?void 0:Z.info)==null?void 0:ee.avatar),class:"h-[40px] w-[40px] duration-600 hover:rotate-360"},null,8,We),e("div",Xe,[e("div",null,[(se=(te=l.user)==null?void 0:te.info)!=null&&se.website?(n(),a("a",{key:1,href:(oe=(ae=l.user)==null?void 0:ae.info)==null?void 0:oe.website,target:"_blank",class:"color-#1abc9c font-500 transition-300"},d((le=l.user)==null?void 0:le.info.nickname),9,et)):(n(),a("span",Ze,d((ne=l.user)==null?void 0:ne.info.nickname),1))]),e("div",tt,[e("div",st,[e("span",null,d(L(fe)(l.created_at).format("YYYY-MM-DD")),1),e("button",{class:A(["i-mdi:thumb-up hover-bg-red",B.value(l.id)?"bg-red":""]),onClick:ke=>V(l)},null,10,nt),C(e("span",null,d(l.like_count),513),[[I,l.like_count]])]),e("button",{class:"color-#ef2f11",onClick:ke=>N(_,l)}," \u56DE\u590D ",8,at)]),e("div",null,[l.user_id!==t.user_id?(n(),a(z,{key:0},[(ce=(ie=l.user)==null?void 0:ie.info)!=null&&ce.website?(n(),a("a",{key:0,href:l.reply_website,target:"_blank"}," @"+d((ue=(re=l.user)==null?void 0:re.info)==null?void 0:ue.nickname),9,ot)):(n(),a("span",lt," @"+d((_e=(de=l.user)==null?void 0:de.info)==null?void 0:_e.nickname),1)),o[0]||(o[0]=F("\uFF0C "))],64)):T("",!0),e("span",{class:"my-3",innerHTML:l.content},null,8,it)])])])}),128)),C(e("div",{ref_for:!0,ref_key:"checkRefs",ref:w,class:"mt-4 text-[13px] color-#6d757a"},[o[1]||(o[1]=F(" \u5171 ")),e("b",null,d(t.reply_count),1),o[2]||(o[2]=F(" \u6761\u56DE\u590D ")),e("button",{class:"color-#00a1d6",onClick:l=>b(_,t)}," \uFF0C\u70B9\u51FB\u67E5\u770B ",8,ct)],512),[[I,t.reply_count>3]]),Y(Pe,{ref_for:!0,ref_key:"pageRefs",ref:m,"page-total":Math.ceil(t.reply_count/5),index:_,"comment-id":t.id,onChangeCurrent:R},null,8,["page-total","index","comment-id"]),Y(me,{ref_for:!0,ref_key:"replyFieldRefs",ref:f,show:!1,type:c.type,"topic-id":p,onAfterSubmit:l=>v(_)},null,8,["type","onAfterSubmit"]),_+1!==i.value?(n(),a("div",rt)):T("",!0)])])}),128)),e("div",ut,[i.value>r.value.length&&!g.value?(n(),a("button",{key:0,text:"",onClick:u}," \u70B9\u51FB\u52A0\u8F7D\u66F4\u591A... ")):T("",!0),Y(Re,{show:g.value},null,8,["show"])])])):(n(),a("div",dt," \u6682\u65E0\u8BC4\u8BBA\uFF0C\u6765\u53D1\u8BC4\u8BBA\u5427~ "))]))}};export{pt as _};
